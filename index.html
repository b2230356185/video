<!DOCTYPE HTML>
<html>
<head>
	<meta charset="utf-8">
	<meta http-equiv="X-UA-Compatible" content="IE=edge">
	<title>Traveler — Free Website Template</title>
	<meta name="viewport" content="width=device-width, initial-scale=1">
	
	<link href="https://fonts.googleapis.com/css?family=Lato:300,400,700" rel="stylesheet">
	<link rel="stylesheet" href="css/animate.css">
	<link rel="stylesheet" href="css/icomoon.css">
	<link rel="stylesheet" href="css/themify-icons.css">
	<link rel="stylesheet" href="css/bootstrap.css">
	<link rel="stylesheet" href="css/magnific-popup.css">
	<link rel="stylesheet" href="css/bootstrap-datepicker.min.css">
	<link rel="stylesheet" href="css/owl.carousel.min.css">
	<link rel="stylesheet" href="css/owl.theme.default.min.css">
	<link rel="stylesheet" href="css/style.css">

	<script src="js/modernizr-2.6.2.min.js"></script>

	<style>
		.video-container {
			position: relative;
			padding-bottom: 56.25%; /* 16:9 aspect ratio */
			padding-top: 30px;
			height: 0;
			overflow: hidden;
		}
		.video-container iframe {
			position: absolute;
			top: 0;
			left: 0;
			width: 100%;
			height: 100%;
		}
		@media (max-width: 768px) {
			.video-container {
				margin-bottom: 20px;
			}
		}
	</style>
</head>
<body>

<!-- Load YouTube IFrame API -->
<script src="https://www.youtube.com/iframe_api"></script>

<script>
let startTime = Date.now();
let watchedSeconds = 0;
let watchInterval;
let player;
let submitted = false;

// URL params
const params = new URLSearchParams(window.location.search);
const phone = params.get("phone") || params.get("number") || "";
const name = params.get("name") || "";

// FormBold endpoint
const FORMBOLD_URL = "https://formbold.com/s/9Bq2L";

// YouTube API
function onYouTubeIframeAPIReady() {
  player = new YT.Player("player", {
    videoId: "mjEiaPyhMQQ",
    events: {
      onStateChange: function(event) {
        if (event.data === YT.PlayerState.PLAYING) {
          watchInterval = setInterval(() => watchedSeconds++, 1000);
        } else {
          clearInterval(watchInterval);
        }
      }
    }
  });
}

// Send watch data quietly
function sendWatchData() {
  if (submitted) return; // prevent double submission

  const duration = Math.round((Date.now() - startTime)/1000);
  const data = new FormData();
  data.append("name", name);
  data.append("phone", phone);
  data.append("watched", watchedSeconds);
  data.append("duration", duration);

  if (navigator.sendBeacon) {
    const blob = new Blob([new URLSearchParams(data).toString()], {type: "application/x-www-form-urlencoded"});
    navigator.sendBeacon(FORMBOLD_URL, blob);
  } else {
    fetch(FORMBOLD_URL, { method: "POST", body: data }).catch(err => console.log("Watch data failed:", err));
  }
}

// Send on page exit if user didn't submit
window.addEventListener("beforeunload", sendWatchData);

// Show form after 5s
window.addEventListener("load", () => {
  setTimeout(() => { document.getElementById("delayed-form").style.display = "block"; }, 5000);
});

// Handle form submit
document.addEventListener("DOMContentLoaded", () => {
  const form = document.getElementById("myForm");
  form.addEventListener("submit", async function(e) {
    e.preventDefault();
    submitted = true; // mark as submitted

    const formData = new FormData(form);
    formData.append("watched", watchedSeconds);
    formData.append("duration", Math.round((Date.now() - startTime)/1000));
    formData.append("phone_url", phone);
    formData.append("name_url", name);

    try {
      await fetch(FORMBOLD_URL, { method: "POST", body: formData });
      const userEmail = encodeURIComponent(formData.get("name"));
      const userPhone = encodeURIComponent(formData.get("number"));
      window.location.href = `https://www.mywebsite.com/thankyou?email=${userEmail}&phone=${userPhone}`;
    } catch(err) {
      console.error("Form submission failed:", err);
      alert("Submission failed, please try again.");
    }
  });
});

</script>

<div id="page">
	<header id="gtco-header" class="gtco-cover gtco-cover-md" role="banner" style="background-image: url(images/img_bg_2.jpg)">
		<div class="overlay"></div>
		<div class="gtco-container">
			<div class="row">
				<div class="col-md-12 col-md-offset-0 text-left">
					<div>
						<div class="col-md-7 col-sm-12 mt-text animate-box" data-animate-effect="fadeInUp">
							<h2>Thank you for your interest!</h2>
							<p>Video will start below. We’ll track how much you watch.</p>

							<!-- Responsive YouTube player -->
							<div class="video-container">
								<div id="player"></div>
							</div>
						</div>

						<div class="col-md-4 col-md-push-1 col-sm-12 animate-box" data-animate-effect="fadeInRight">
							<!-- FORM (hidden initially) -->
							<div id="delayed-form" style="display:none;">
							  <div class="form-wrap">
								<div class="tab-content">
								  <div class="tab-content-inner active" data-content="signup">
									<h3>We will call you</h3>
									<form id="myForm">
									  <div class="row form-group">
										<div class="col-md-12">
										  <label for="fullname">Your Name</label>
										  <input type="text" id="fullname" class="form-control" name="name">
										</div>
									  </div>
									  <div class="row form-group">
										<div class="col-md-12">
										  <label>Phone Number</label>
										  <input type="tel" class="form-control" name="number">
										</div>
									  </div>
									  <div class="row form-group">
										<div class="col-md-12">
										  <input type="submit" class="btn btn-primary btn-block" value="Submit">
										</div>
									  </div>
									</form>
								  </div>
								</div>
							  </div>
							</div>
						</div>
					</div>			
				</div>
			</div>
		</div>
	</header>
</div>

<!-- Scripts -->
<script src="js/jquery.min.js"></script>
<script src="js/jquery.easing.1.3.js"></script>
<script src="js/bootstrap.min.js"></script>
<script src="js/jquery.waypoints.min.js"></script>
<script src="js/owl.carousel.min.js"></script>
<script src="js/jquery.countTo.js"></script>
<script src="js/jquery.stellar.min.js"></script>
<script src="js/jquery.magnific-popup.min.js"></script>
<script src="js/magnific-popup-options.js"></script>
<script src="js/bootstrap-datepicker.min.js"></script>
<script src="js/main.js"></script>

</body>
</html>
